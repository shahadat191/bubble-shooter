import{a as d,b as c,c as R,d as y,e as f,f as S,g,h as I,i as w,j as P,k as G,l as O,m as k,n as F,o as j,s as C}from"./chunk-DTZSUXJ4.js";var m=class{x;y;angle;bubbleRadius;colors;nextBubbleColor;queuedBubbles=[];barrelLength=50;baseRadius=30;glowIntensity=0;glowDirection=.05;constructor(s,t,e=0,i,o){this.x=s,this.y=t,this.angle=e,this.bubbleRadius=i,this.colors=o,this.nextBubbleColor=this.getRandomColor(),this.queuedBubbles=[this.getRandomColor(),this.getRandomColor()]}draw(s){s.save(),this.glowIntensity+=this.glowDirection,(this.glowIntensity>1||this.glowIntensity<0)&&(this.glowDirection*=-1);let t=s.createRadialGradient(this.x,this.y,0,this.x,this.y,this.baseRadius);t.addColorStop(0,"#555"),t.addColorStop(1,"#333"),s.beginPath(),s.arc(this.x,this.y,this.baseRadius,0,Math.PI*2),s.fillStyle=t,s.fill(),s.translate(this.x,this.y),s.rotate(-this.angle+Math.PI/2);let e=s.createLinearGradient(0,-this.barrelLength,0,0);e.addColorStop(0,"#666"),e.addColorStop(1,"#444"),s.beginPath(),s.moveTo(-6,0),s.lineTo(-8,-this.barrelLength),s.lineTo(8,-this.barrelLength),s.lineTo(6,0),s.closePath(),s.fillStyle=e,s.fill(),s.beginPath(),s.moveTo(-6,0),s.lineTo(-8,-this.barrelLength),s.lineTo(-4,-this.barrelLength),s.lineTo(-2,0),s.closePath(),s.fillStyle="rgba(255, 255, 255, 0.2)",s.fill(),s.restore(),this.drawBubble(s,this.x+Math.cos(this.angle)*(this.barrelLength+this.bubbleRadius),this.y-Math.sin(this.angle)*(this.barrelLength+this.bubbleRadius),this.nextBubbleColor,!0);for(let i=0;i<this.queuedBubbles.length;i++)this.drawBubble(s,this.x-(i+1)*this.bubbleRadius*3.5,this.y,this.queuedBubbles[i],!1)}drawBubble(s,t,e,i,o){s.beginPath(),s.arc(t,e+2,this.bubbleRadius,0,Math.PI*2),s.fillStyle="rgba(0, 0, 0, 0.3)",s.fill();let a=s.createRadialGradient(t-this.bubbleRadius*.3,e-this.bubbleRadius*.3,0,t,e,this.bubbleRadius);a.addColorStop(0,this.lightenColor(i,50)),a.addColorStop(.6,i),a.addColorStop(1,this.darkenColor(i,30)),s.beginPath(),s.arc(t,e,this.bubbleRadius,0,Math.PI*2),s.fillStyle=a,s.fill(),s.beginPath(),s.arc(t-this.bubbleRadius*.3,e-this.bubbleRadius*.3,this.bubbleRadius*.4,0,Math.PI*2),s.fillStyle="rgba(255, 255, 255, 0.4)",s.fill(),o&&(s.beginPath(),s.arc(t,e,this.bubbleRadius+2,0,Math.PI*2),s.fillStyle=`rgba(255, 255, 255, ${.3*this.glowIntensity})`,s.fill())}prepareNextShot(){for(this.nextBubbleColor=this.queuedBubbles.shift()||this.getRandomColor(),this.queuedBubbles.push(this.getRandomColor());this.queuedBubbles.length<2;)this.queuedBubbles.push(this.getRandomColor())}aim(s,t){let e=s-this.x,i=this.y-t;this.angle=Math.atan2(i,e);let o=Math.PI/9;this.angle=Math.max(o,Math.min(this.angle,Math.PI-o))}getRandomColor(){return this.colors[Math.floor(Math.random()*this.colors.length)]}shootBubble(){let s=this.nextBubbleColor;return this.nextBubbleColor=this.queuedBubbles.shift(),this.queuedBubbles.push(this.getRandomColor()),s}getBubblePosition(){return{x:this.x+Math.sin(this.angle)*(this.barrelLength+this.bubbleRadius),y:this.y-Math.cos(this.angle)*(this.barrelLength+this.bubbleRadius)}}lightenColor(s,t){return this.adjustColor(s,t)}darkenColor(s,t){return this.adjustColor(s,-t)}adjustColor(s,t){let e=s.replace(/^#/,""),i=parseInt(e,16),o=(i>>16)+t,a=(i>>8&255)+t,r=(i&255)+t;return o=Math.clamp(o,0,255),a=Math.clamp(a,0,255),r=Math.clamp(r,0,255),`#${((1<<24)+(o<<16)+(a<<8)+r).toString(16).slice(1)}`}};Math.clamp=(n,s,t)=>Math.min(Math.max(n,s),t);var p=(()=>{class n{x;y;radius;color;direction;static ANIMATION_SPEED=.002;static ANIMATION_AMOUNT=.05;animationOffset=Math.random()*Math.PI*2;lightAngle=Math.random()*Math.PI*2;constructor(t,e,i,o,a){this.x=t,this.y=e,this.radius=i,this.color=o,this.direction=a}draw(t,e){let i=this.x,o=this.y+e;this.animationOffset+=n.ANIMATION_SPEED;let a=1+Math.sin(this.animationOffset)*n.ANIMATION_AMOUNT,r=this.radius*a;this.lightAngle+=.02;let h=Math.cos(this.lightAngle)*r*.5,b=Math.sin(this.lightAngle)*r*.5;t.save();let u=t.createRadialGradient(i+h,o+b,0,i,o,r);u.addColorStop(0,this.lightenColor(this.color,30)),u.addColorStop(.5,this.color),u.addColorStop(1,this.darkenColor(this.color,30)),t.fillStyle=u,t.beginPath(),t.arc(i,o,r,0,Math.PI*2),t.fill();let l=t.createRadialGradient(i+h*.8,o+b*.8,0,i+h*.8,o+b*.8,r*.5);l.addColorStop(0,"rgba(255, 255, 255, 0.6)"),l.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=l,t.beginPath(),t.arc(i+h*.8,o+b*.8,r*.5,0,Math.PI*2),t.fill(),t.strokeStyle=this.lightenColor(this.color,40),t.lineWidth=2,t.beginPath(),t.arc(i,o,r-1,0,Math.PI*2),t.stroke(),t.shadowColor="rgba(0, 0, 0, 0.2)",t.shadowBlur=10,t.shadowOffsetX=-h*.5,t.shadowOffsetY=-b*.5,t.beginPath(),t.arc(i,o,r-2,0,Math.PI*2),t.stroke(),t.restore()}lightenColor(t,e){return this.adjustColor(t,e)}darkenColor(t,e){return this.adjustColor(t,-e)}adjustColor(t,e){return"#"+t.replace(/^#/,"").replace(/../g,i=>("0"+Math.min(255,Math.max(0,parseInt(i,16)+e)).toString(16)).substr(-2))}}return n})();var B=(()=>{class n{bubbles=[];colors=["#FF6B6B","#4ECDC4","#FFD93D"];rows=8;columns=12;bubbleRadius=18;gridOffsetX=this.bubbleRadius*1.5;gridOffsetY=this.bubbleRadius*1.5;startX;startY;horizontalOffset;verticalOffset;constructor(){this.startX=this.bubbleRadius*1.5,this.startY=this.bubbleRadius*1.5,this.horizontalOffset=this.bubbleRadius*2.1,this.verticalOffset=this.bubbleRadius*1.8}createInitialGrid(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++){let i=this.startX+e*this.horizontalOffset+(t%2===1?this.bubbleRadius:0),o=this.startY+t*this.verticalOffset,a=this.colors[Math.floor(Math.random()*this.colors.length)];this.bubbles.push(new p(i,o,this.bubbleRadius,a,0))}}findNearestGridPosition(t,e){let i=Math.round((e-this.startY)/this.verticalOffset),o=t-(i%2===1?this.bubbleRadius:0),a=Math.round((o-this.startX)/this.horizontalOffset),r=this.startX+a*this.horizontalOffset+(i%2===1?this.bubbleRadius:0),h=this.startY+i*this.verticalOffset;return{x:r,y:h}}addBubble(t){let{x:e,y:i}=this.findNearestGridPosition(t.x,t.y);t.x=e,t.y=i,this.bubbles.push(t)}drawBubbles(t,e){this.bubbles.forEach(i=>i.draw(t,e))}getBubbles(){return this.bubbles}checkBubbleCollision(t,e){let i=this.getBubbles();for(let o of i){let a=t-o.x,r=e-o.y;if(Math.sqrt(a*a+r*r)<this.bubbleRadius*2)return!0}return!1}popBubbles(t){this.bubbles=this.bubbles.filter(e=>!t.includes(e))}findMatches(t){let e=[t],i=new Set([t]),o=[t];for(;o.length>0;){let a=o.shift(),r=this.getNeighbors(a);for(let h of r)!i.has(h)&&h.color===t.color&&(e.push(h),i.add(h),o.push(h))}return e.length>=2?e:[]}getNeighbors(t){return this.findBubbleAt(t.x,t.y)}findBubbleAt(t,e){let i=this.bubbleRadius*2.26;console.log(`Searching for bubble at (${t}, ${e}) with max distance ${i}`);let o=[];for(let a of this.bubbles){let r=a.x-t,h=a.y-e;Math.sqrt(r*r+h*h)<i&&(console.log(`Found matching bubble: ${JSON.stringify(a)}`),o.push(a))}return o}removeBubbles(t){this.bubbles=this.bubbles.filter(e=>!t.includes(e))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var A=(()=>{class n{bubbleManagerService;constructor(t){this.bubbleManagerService=t}initGame(){this.bubbleManagerService.createInitialGrid()}static \u0275fac=function(e){return new(e||n)(R(B))};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var X=["gameCanvas"],T=(()=>{class n{gameService;bubbleManagerService;ngZone;canvasRef;ctx;shooter;colors=["#FF6B6B","#4ECDC4","#FFD93D"];bubbleRadius=18;canvasWidth=500;canvasHeight=700;animationFrameId;shotBubble=null;bubbleSpeed=10;animationOffset=0;constructor(t,e,i){this.gameService=t,this.bubbleManagerService=e,this.ngZone=i}ngOnInit(){this.gameService.initGame()}ngAfterViewInit(){this.ctx=this.canvasRef.nativeElement.getContext("2d"),this.canvasRef.nativeElement.width=this.canvasWidth,this.canvasRef.nativeElement.height=this.canvasHeight,this.shooter=new m(this.canvasWidth/2,this.canvasHeight-40,0,this.bubbleRadius,this.colors),this.ngZone.runOutsideAngular(()=>{this.gameLoop()})}gameLoop(){this.ctx.fillStyle="#2C2C2C",this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.updateGameState(),this.bubbleManagerService.drawBubbles(this.ctx,0),this.shotBubble||this.drawTrajectory(),this.shooter.draw(this.ctx),this.shotBubble&&this.shotBubble.draw(this.ctx,0),this.animationFrameId=requestAnimationFrame(()=>this.gameLoop())}drawTrajectory(){if(this.shotBubble)return;let t=40,e=this.shooter.x+Math.cos(this.shooter.angle)*t,i=this.shooter.y-Math.sin(this.shooter.angle)*t,o=this.shooter.angle,a=e,r=i,h=10,b=5;this.ctx.beginPath(),this.ctx.moveTo(e,i),this.ctx.setLineDash([5,5]),this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)";for(let u=0;u<500;u++){let l=a+Math.cos(o)*h,v=r-Math.sin(o)*h;if(this.bubbleManagerService.checkBubbleCollision(l,v))break;if(l<=this.bubbleRadius||l>=this.canvasWidth-this.bubbleRadius){if(o=Math.PI-o,--b<0)break;a=l<=this.bubbleRadius?this.bubbleRadius:this.canvasWidth-this.bubbleRadius,r=v}else a=l,r=v;if(r<=this.bubbleRadius)break;this.ctx.lineTo(a,r)}this.ctx.stroke(),this.ctx.setLineDash([])}updateGameState(){this.shotBubble&&this.moveShotBubble()&&this.handleCollision()}moveShotBubble(){if(!this.shotBubble)return!1;let t=8,e=this.shotBubble.x+Math.cos(this.shotBubble.direction)*t,i=this.shotBubble.y-Math.sin(this.shotBubble.direction)*t;return this.checkCollision(e,i)?!0:(this.shotBubble.x=e,this.shotBubble.y=i,!1)}checkCollision(t,e){if(t<=this.bubbleRadius||t>=this.canvasWidth-this.bubbleRadius||e<=this.bubbleRadius){this.shotBubble.direction=Math.PI-this.shotBubble.direction;let i=5;return this.shotBubble.x=this.shotBubble.x+Math.cos(this.shotBubble.direction)*i,this.shotBubble.y=this.shotBubble.y-Math.sin(this.shotBubble.direction)*i,!1}return this.bubbleManagerService.checkBubbleCollision(t,e)}handleCollision(){if(!this.shotBubble)return;this.snapBubbleToGrid();let t=this.checkForMatches();t.length>0&&this.removeBubbles(t),this.shotBubble=null,this.shooter.prepareNextShot()}snapBubbleToGrid(){this.shotBubble&&this.bubbleManagerService.addBubble(this.shotBubble)}checkForMatches(){return this.shotBubble?this.bubbleManagerService.findMatches(this.shotBubble):[]}removeBubbles(t){this.bubbleManagerService.removeBubbles(t)}onMouseMove(t){let e=this.canvasRef.nativeElement.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;this.shooter.aim(i,o)}onClick(t){if(!this.shotBubble){let e=this.shooter.shootBubble(),i=40,o=this.shooter.x+Math.cos(this.shooter.angle)*(i+this.bubbleRadius),a=this.shooter.y-Math.sin(this.shooter.angle)*(i+this.bubbleRadius);this.shotBubble=new p(o,a,this.bubbleRadius,e,this.shooter.angle)}}ngOnDestroy(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}static \u0275fac=function(e){return new(e||n)(g(A),g(B),g(S))};static \u0275cmp=y({type:n,selectors:[["app-game"]],viewQuery:function(e,i){if(e&1&&O(X,7),e&2){let o;k(o=F())&&(i.canvasRef=o.first)}},hostBindings:function(e,i){e&1&&G("mousemove",function(a){return i.onMouseMove(a)})("click",function(a){return i.onClick(a)})},decls:3,vars:0,consts:[["gameCanvas",""],[1,"game-container"]],template:function(e,i){e&1&&(I(0,"div",1),P(1,"canvas",null,0),w())},styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;background-color:#1e1e1e}.game-container[_ngcontent-%COMP%]{border-radius:10px;overflow:hidden;box-shadow:0 0 20px #4a90e24d}"]})}return n})();var q=[{path:"",component:T}],L=(()=>{class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=f({type:n});static \u0275inj=c({imports:[C.forChild(q),C]})}return n})();var K=(()=>{class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=f({type:n});static \u0275inj=c({imports:[j,L]})}return n})();export{K as GameModule};
